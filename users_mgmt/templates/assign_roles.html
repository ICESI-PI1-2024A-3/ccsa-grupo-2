{% extends "layouts/base.html" %}
{% block content %}
    {% comment %} <div class="container">
        <div class="header">
            <h2>Usuarios</h2>
            <form method="get" action="{% url 'search_users' %}">
                <input type="text" class="search" name="search_query" placeholder="Buscar por nombre...">
                <button type="submit" class="button">Buscar</button>
            </form>
        </div>
        <table class="table-users">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Correo Electrónico</th>
                    <th>Teléfono</th>
                    <th>Fecha de registro</th>
                    <th>Estado</th>
                    <th>Rol</th>
                </tr>
            </thead>
            <tbody>
                {% if search_query %}
                    {% for user, form in users_and_forms %}
                        <tr>
                            <td>{{ user }}</td>
                            <td>{{ user.email }}</td>
                            <td>{{ user.phone }}</td>
                            <td>{{ user.created_at|date:"d/m/Y" }}</td>
                            <td>
                                {% if user.is_active %}
                                    Activo
                                {% else %}
                                    Inactivo
                                {% endif %}
                            </td>
                            <td>
                                <form class="form-role" method="post" action="{% url 'assign_roles' %}">
                                    {% csrf_token %}
                                    {{ form }}
                                    <button type="submit" class="button" {% if user.role == form.role.data %}disabled{% endif %}>Cambiar</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    {% for user, form in users_and_forms %}
                        <tr>
                            <td>{{ user }}</td>
                            <td>{{ user.email }}</td>
                            <td>{{ user.phone }}</td>
                            <td>{{ user.created_at|date:"d/m/Y" }}</td>
                            <td>
                                {% if user.is_active %}
                                    Activo
                                {% else %}
                                    Inactivo
                                {% endif %}
                            </td>
                            <td>
                                <form class="form-role" method="post" action="{% url 'assign_roles' %}">
                                    {% csrf_token %}
                                    {{ form }}
                                    <button type="submit" class="button" {% if user.role == form.role.data %}disabled{% endif %}>Cambiar</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>
    </div> {% endcomment %}
    {% include "sidemenu.html" %}
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center">
            <h2>Usuarios</h2>
            <form method="get" action="{% url 'search_users' %}" class="d-flex">
                <input type="text"
                       class="form-control me-2"
                       name="search_query"
                       placeholder="Buscar por nombre...">
                <button type="submit" class="btn btn-primary">Buscar</button>
            </form>
        </div>
        <table class="table table-striped table-bordered mt-4">
            <thead>
                <tr>
                    <th style="background-color: #1E4072;" class="text-light">Nombre</th>
                    <th style="background-color: #1E4072;" class="text-light">Correo Electrónico</th>
                    <th style="background-color: #1E4072;" class="text-light">Teléfono</th>
                    <th style="background-color: #1E4072;" class="text-light">Fecha de registro</th>
                    <th style="background-color: #1E4072;" class="text-light">Estado</th>
                    <th style="background-color: #1E4072;" class="text-light">Rol</th>
                </tr>
            </thead>
            <tbody>
                {% if search_query %}
                    {% for user, form in users_and_forms %}
                        <tr>
                            <td>{{ user }}</td>
                            <td>{{ user.email }}</td>
                            <td>{{ user.phone }}</td>
                            <td>{{ user.created_at|date:"d/m/Y" }}</td>
                            <td>
                                {% if user.is_active %}
                                    Activo
                                {% else %}
                                    Inactivo
                                {% endif %}
                            </td>
                            <td>
                                <form method="post" action="{% url 'assign_roles' %}" class="d-inline-flex">
                                    {% csrf_token %}
                                    {{ form.role }}
                                    <button type="submit"
                                            class="btn btn-primary ms-2"
                                            {% if user.role == form.role.data %}disabled{% endif %}>Cambiar</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    {% for user, form in users_and_forms %}
                        <tr>
                            <td>{{ user }}</td>
                            <td>{{ user.email }}</td>
                            <td>{{ user.phone }}</td>
                            <td>{{ user.created_at|date:"d/m/Y" }}</td>
                            <td>
                                {% if user.is_active %}
                                    Activo
                                {% else %}
                                    Inactivo
                                {% endif %}
                            </td>
                            <td>
                                <form method="post" action="{% url 'assign_roles' %}" class="d-inline-flex">
                                    {% csrf_token %}
                                    {{ form.role }}
                                    <button type="submit"
                                            class="btn btn-primary ms-2"
                                            {% if user.role == form.role.data %}disabled{% endif %}>Cambiar</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>
    </div>
{% endblock %}
